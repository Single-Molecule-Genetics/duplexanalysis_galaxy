<?xml version="1.0" encoding="UTF-8"?>
<tool id="fsd_regions" name="Duplex Sequencing Analysis: fsd_regions" version="1.0.1">
    <description>Family size distribution (FSD) of user-specified regions in the reference genome</description>
    <requirements>
        <requirement type="package" version="2.7">python</requirement>
        <requirement type="package" version="1.4.0">matplotlib</requirement>
    </requirements>
    <command>
        python2 '$__tool_directory__/fsd_regions.py' --inputFile '$file1' --inputName1 '$file1.name' --bamFile '$file2' --rangesFile '$file3' --output_pdf $output_pdf --output_tabular $output_tabular 
    </command>
    <inputs>
        <param name="file1" type="data" format="tabular" label="Dataset 1: input tags of whole dataset" optional="false" help="Input in tabular format with the family size, tags and the direction of the strand ('ab' or 'ba') for each family."/>
        <param name="file2" type="data" format="bam" label="Dataset 2: BAM file of aligned reads." help="Input in BAM format with the reads that were aligned to the reference genome."/>
        <param name="file3" type="data" format="bed" label="Dataset 3: BED file with chromsome, start and stop positions of regions." optional="true" help="BED file with start and stop positions of regions."/>
    </inputs>
    <outputs>
        <data name="output_pdf" format="pdf" />
        <data name="output_tabular" format="tabular"/>
    </outputs>
    <tests>
        <test>
            <param name="file1" value="fsd_reg.tab"/>
            <param name="file2" value="fsd_reg.bam"/>
            <param name="file3" value="fsd_reg_ranges.bed"/>
            <output name="output_pdf" file="fsd_reg_output.pdf" lines_diff="136"/>
            <output name="output_tabular" file="fsd_reg_output.tab"/>
        </test>
    </tests>
    <help> <![CDATA[

**What it does**
        
This tool will create a distribution of family sizes of all tags, which were aligned to the reference genome. The distribution is separated after the regions of the reference genome.
               
        
**Input**
        
**Dataset 1:** This tools expects a tabular file with the tags of all families, their sizes and information about forward (ab) and reverse (ba) strands. 

    1  AAAAAAAAAAAATGTTGGAATCTT ba
   10  AAAAAAAAAAAGGCGGTCCACCCC ab
   28  AAAAAAAAAAATGGTATGGACCGA ab
    
**Dataset 2:** BAM file of the aligned reads. This file can be obtained by the tool "Map with BWA-MEM".

**Dataset 3 (optional):** BED file with start and stop positions of the regions. If it is not provided, then all aligned reads of the BAM file are used in the distribution of family sizes. 

   ACH_TDII   90    633
   ACH_TDII  659   1140
   ACH_TDII 1144   1561
    
**Output**
        
The output is a PDF file with the plot and a tabular file with the data of the plot.
        
        
**About Author**
        
    Author: Monika Heinzl
    
    Department: Institute of Bioinformatics, Johannes Kepler University Linz, Austria
    
    Contact: monika.heinzl@edumail.at
        
        ]]> 

    </help>
    <citations>
        <citation type="bibtex">
            @misc{duplex,
            author = {Heinzl, Monika},
            year = {2018},
            title = {Development of algorithms for the analysis of duplex sequencing data}
         }
        </citation>
    </citations>
</tool>
